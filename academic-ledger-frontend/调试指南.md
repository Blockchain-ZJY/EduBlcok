# 🔍 调试指南 - 解决显示问题

## 问题现象
- 信息显示还是乱的，不整齐
- IPFS图片没有显示

## ✅ 第一步：完全清除缓存

### 方法1：硬刷新（推荐）

1. **打开你的浏览器开发工具**
   - 按 `F12` 键
   - 或右键 → "检查"

2. **打开Network（网络）标签**

3. **勾选"Disable cache"（禁用缓存）**

4. **按住Ctrl键，点击浏览器的刷新按钮**
   - 或按 `Ctrl + Shift + R`（Windows/Linux）
   - 或按 `Cmd + Shift + R`（Mac）

### 方法2：清除浏览器缓存

1. 按 `Ctrl + Shift + Delete`
2. 选择"缓存的图片和文件"
3. 时间范围选择"全部时间"
4. 点击"清除数据"
5. 关闭浏览器，重新打开

### 方法3：使用无痕模式

1. 按 `Ctrl + Shift + N`（Chrome/Edge）
2. 或 `Ctrl + Shift + P`（Firefox）
3. 在无痕模式中访问你的应用

## ✅ 第二步：查看控制台调试信息

现在我已经添加了详细的调试日志。请执行以下操作：

### 1. 打开开发者工具
按 `F12` 键

### 2. 切换到Console（控制台）标签

### 3. 点击"我的证书"按钮

### 4. 查看控制台输出

你应该看到类似这样的信息：

```
📚 证书总数: 1
📜 第一个证书数据: {id: 1, student: "0x...", institution: "0x...", ...}
📎 证书URI: bafkreiaqcdrubsxyq2smkh5zdpb3gmvmmkhr5ytfe25bgeo3lsrdr66gna
✅ IPFS URI已设置: bafkreiaqcdrubsxyq2smkh5zdpb3gmvmmkhr5ytfe25bgeo3lsrdr66gna
✅ 检测到文件类型: image
🚀 准备显示模态框，参数: {ipfsUri: "bafkrei...", docType: "image"}
📦 ConfirmModal收到的props: {ipfsUri: "bafkrei...", documentType: "image"}
🌐 转换后的HTTP URL: https://gateway.pinata.cloud/ipfs/bafkrei...
🔍 格式化后的HTML: <div class="section-header student-section">...
```

## ⚠️ 可能的问题及解决方案

### 问题1: 没有看到"📚 证书总数"日志
**原因**：代码没有正确更新  
**解决**：
```bash
# 在 academic-ledger-frontend 目录中
# 停止服务器 (Ctrl+C)
# 删除node_modules/.vite缓存
rm -rf node_modules/.vite
# 重启
npm run dev
```

### 问题2: 看到"⚠️ 证书URI为空"
**原因**：证书创建时没有上传IPFS文件  
**解决**：
1. 作为院校身份，重新签发一个证书
2. 这次使用"使用IPFS签发证书"功能
3. 上传一个图片文件（.jpg, .png等）
4. 等待上传完成后再签发

### 问题3: 看到"❌ 无法获取第一个证书的URI"
**原因**：合约调用失败  
**解决**：
1. 检查MetaMask是否连接
2. 检查是否在正确的网络
3. 刷新页面重新连接

### 问题4: 看到所有日志，但显示还是乱的
**原因**：CSS文件没有正确加载  
**解决**：

1. 在开发工具的Console中输入：
```javascript
document.querySelector('.certificate-details')
```
如果返回`null`，说明HTML结构没有正确渲染。

2. 检查CSS是否加载：
```javascript
getComputedStyle(document.querySelector('.info-row'))
```
应该显示`display: "grid"`

3. 如果上述都不行，尝试：
```bash
# 完全停止服务器
# 删除所有缓存
rm -rf node_modules/.vite
rm -rf dist
# 重启
npm run dev
```

### 问题5: HTML显示但没有格式
**原因**：`formatCertificateMessage`函数没有正确工作  
**查看**：控制台应该有"🔍 格式化后的HTML"日志

**应该包含**：
```html
<div class="section-header student-section">
  <span class="section-icon">👤</span>
  <span class="section-title">学生信息</span>
</div>
<div class="info-row">
  <div class="info-label-col">姓名</div>
  <div class="info-value-col">张三</div>
</div>
```

如果格式化后的HTML还是纯文本（没有`<div>`标签），说明正则表达式没有匹配成功。

## 📸 截图给我看

如果以上步骤都做了还是不行，请：

1. **打开F12开发工具**
2. **切换到Console标签**
3. **点击"我的证书"**
4. **截图整个Console输出**，包括：
   - 所有的emoji表情日志（📚、📜、📎等）
   - 任何错误信息（红色文字）
5. **同时截图当前显示的弹窗**
6. **发送给我**

## 🧪 快速测试

在Console中粘贴以下代码测试CSS是否正常：

```javascript
// 测试CSS Grid是否生效
const testDiv = document.createElement('div');
testDiv.className = 'info-row';
testDiv.innerHTML = '<div class="info-label-col">测试</div><div class="info-value-col">值</div>';
document.body.appendChild(testDiv);
const styles = getComputedStyle(testDiv);
console.log('Grid样式:', styles.display);
testDiv.remove();
```

应该输出：`Grid样式: grid`

如果输出的不是"grid"，说明CSS没有正确加载。

## 🚀 最后的终极解决方案

如果以上全部都不行：

```bash
# 1. 停止所有服务器
# 按 Ctrl+C 停止

# 2. 完全清理
rm -rf node_modules
rm -rf node_modules/.vite
rm -rf dist
rm package-lock.json

# 3. 重新安装
npm install

# 4. 重启
npm run dev

# 5. 浏览器开无痕模式访问
```

## 📝 收集信息清单

如果还是不行，请提供以下信息：

- [ ] 浏览器版本（Chrome/Firefox/Edge等）
- [ ] 操作系统（Windows/Mac/Linux）
- [ ] Console中的所有日志（截图）
- [ ] Network标签中是否有404错误
- [ ] 当前显示的弹窗（截图）
- [ ] `getComputedStyle(document.querySelector('.info-row'))` 的输出
- [ ] 证书是否有IPFS URI（控制台日志中的"📎 证书URI"）

---

**请现在就按照步骤操作，然后把Console的截图发给我！** 🔍

